<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:ArchiDesignPatterns.Mobile.ViewModels"
             x:Class="ArchiDesignPatterns.Mobile.Pages.SOLIDPrinciples.DependencyInversionPrinciplePage"
             x:DataType="viewmodels:DependencyInversionPrincipleViewModel"
             Title="Dependency Inversion">

    <Grid RowDefinitions="Auto,*">
        
        <!-- Header -->
        <Border Grid.Row="0"
                BackgroundColor="{StaticResource SOLIDPrinciple}"
                Padding="20,24,20,20"
                StrokeThickness="0">
            <VerticalStackLayout Spacing="8">
                <HorizontalStackLayout Spacing="12">
                    <Label Text="🔷" FontSize="32" VerticalOptions="Center" />
                    <VerticalStackLayout Spacing="4">
                        <Label Text="Dependency Inversion Principle"
                               FontSize="28" FontAttributes="Bold"
                               TextColor="White" />
                        <Border BackgroundColor="White" Opacity="0.3"
                                Padding="8,4" StrokeThickness="0"
                                StrokeShape="RoundRectangle 6"
                                HorizontalOptions="Start">
                            <Label Text="SOLID" FontSize="11"
                                   FontAttributes="Bold" TextColor="White" />
                        </Border>
                    </VerticalStackLayout>
                </HorizontalStackLayout>
            </VerticalStackLayout>
        </Border>

        <ScrollView Grid.Row="1">
            <VerticalStackLayout Style="{StaticResource PatternDetailContainer}">
                
                <!-- Description Card -->
                <Border Style="{StaticResource ElevatedCard}">
                    <VerticalStackLayout Spacing="12">
                        <Label Text="📖 Description"
                               Style="{StaticResource SubTitle}" />
                        <BoxView Style="{StaticResource Divider}" Margin="0,0" />
                        <Label Text="Le principe d'inversion de dépendances stipule que les modules de haut niveau ne doivent pas dépendre des modules de bas niveau. Les deux doivent dépendre d'abstractions. Les abstractions ne doivent pas dépendre des détails, mais les détails doivent dépendre des abstractions."
                               Style="{StaticResource BodyLarge}"
                               LineBreakMode="WordWrap" />
                    </VerticalStackLayout>
                </Border>

                <!-- Key Concepts -->
                <Border Style="{StaticResource Card}">
                    <VerticalStackLayout Spacing="12">
                        <Label Text="🔑 Concepts Clés"
                               Style="{StaticResource SubTitle}" />
                        <BoxView Style="{StaticResource Divider}" Margin="0,0" />
                        <VerticalStackLayout Spacing="8">
                            <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12">
                                <Label Text="✓" FontSize="18" TextColor="{StaticResource Success}" />
                                <Label Grid.Column="1" Text="Dépendre d'abstractions (interfaces) pas d'implémentations"
                                       Style="{StaticResource BodyMedium}" LineBreakMode="WordWrap" />
                            </Grid>
                            <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12">
                                <Label Text="✓" FontSize="18" TextColor="{StaticResource Success}" />
                                <Label Grid.Column="1" Text="Modules de haut niveau indépendants des détails"
                                       Style="{StaticResource BodyMedium}" LineBreakMode="WordWrap" />
                            </Grid>
                            <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12">
                                <Label Text="✓" FontSize="18" TextColor="{StaticResource Success}" />
                                <Label Grid.Column="1" Text="Injection de dépendances (DI) pour la flexibilité"
                                       Style="{StaticResource BodyMedium}" LineBreakMode="WordWrap" />
                            </Grid>
                            <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12">
                                <Label Text="✓" FontSize="18" TextColor="{StaticResource Success}" />
                                <Label Grid.Column="1" Text="Facilite les tests et le changement d'implémentations"
                                       Style="{StaticResource BodyMedium}" LineBreakMode="WordWrap" />
                            </Grid>
                        </VerticalStackLayout>
                    </VerticalStackLayout>
                </Border>

                <!-- Interactive Example -->
                <Border Style="{StaticResource InteractiveSection}">
                    <VerticalStackLayout Spacing="16">
                        <HorizontalStackLayout Spacing="8">
                            <Label Text="🎮" FontSize="20" VerticalOptions="Center" />
                            <Label Text="Exemple Interactif"
                                   Style="{StaticResource SubTitle}"
                                   TextColor="{StaticResource Primary}"
                                   VerticalOptions="Center" />
                        </HorizontalStackLayout>
                        <BoxView Style="{StaticResource Divider}" Margin="0,0" />
                        <Label Text="Comparez un couplage fort avec l'inversion de dépendances :"
                               Style="{StaticResource BodyMedium}"
                               LineBreakMode="WordWrap" />
                        <Button Text="Voir l'Exemple ❌ (Violation)"
                                Clicked="OnShowViolationClicked"
                                HorizontalOptions="Fill"
                                BackgroundColor="{StaticResource Error}" />
                        <Button Text="Voir l'Exemple ✓ (Respect du DIP)"
                                Clicked="OnShowCorrectClicked"
                                HorizontalOptions="Fill"
                                BackgroundColor="{StaticResource Success}" />
                        <Label x:Name="ResultLabel"
                               Style="{StaticResource ResultLabel}"
                               LineBreakMode="WordWrap" />
                    </VerticalStackLayout>
                </Border>

                <!-- Bad Example -->
                <Border Style="{StaticResource CodeSection}">
                    <VerticalStackLayout Spacing="12">
                        <HorizontalStackLayout Spacing="8">
                            <Label Text="❌" FontSize="20" />
                            <Label Text="Mauvais Exemple (Violation)"
                                   Style="{StaticResource SubTitle}" />
                        </HorizontalStackLayout>
                        <BoxView Style="{StaticResource Divider}" Margin="0,0" />
                        <Editor Style="{StaticResource CodeEditor}"
                                Text="// ❌ Mauvais : Couplage fort&#x0a;public class EmailNotification&#x0a;{&#x0a;    public void Send(string message)&#x0a;    {&#x0a;        Console.WriteLine($&quot;Email: {message}&quot;);&#x0a;    }&#x0a;}&#x0a;&#x0a;public class UserService&#x0a;{&#x0a;    private EmailNotification _notification;&#x0a;&#x0a;    public UserService()&#x0a;    {&#x0a;        _notification = new EmailNotification();&#x0a;    }&#x0a;&#x0a;    public void NotifyUser(string message)&#x0a;    {&#x0a;        _notification.Send(message);&#x0a;    }&#x0a;}&#x0a;&#x0a;// Problème: Pour utiliser SMS, on doit modifier UserService !" />
                    </VerticalStackLayout>
                </Border>

                <!-- Good Example -->
                <Border Style="{StaticResource CodeSection}">
                    <VerticalStackLayout Spacing="12">
                        <HorizontalStackLayout Spacing="8">
                            <Label Text="✅" FontSize="20" />
                            <Label Text="Bon Exemple (Respect du DIP)"
                                   Style="{StaticResource SubTitle}" />
                        </HorizontalStackLayout>
                        <BoxView Style="{StaticResource Divider}" Margin="0,0" />
                        <Editor Style="{StaticResource CodeEditor}"
                                Text="// ✅ Bon : Dépendre d'une abstraction&#x0a;public interface INotification&#x0a;{&#x0a;    void Send(string message);&#x0a;}&#x0a;&#x0a;public class EmailNotification : INotification&#x0a;{&#x0a;    public void Send(string message)&#x0a;    {&#x0a;        Console.WriteLine($&quot;Email: {message}&quot;);&#x0a;    }&#x0a;}&#x0a;&#x0a;public class SmsNotification : INotification&#x0a;{&#x0a;    public void Send(string message)&#x0a;    {&#x0a;        Console.WriteLine($&quot;SMS: {message}&quot;);&#x0a;    }&#x0a;}&#x0a;&#x0a;public class UserService&#x0a;{&#x0a;    private readonly INotification _notification;&#x0a;&#x0a;    public UserService(INotification notification)&#x0a;    {&#x0a;        _notification = notification;&#x0a;    }&#x0a;&#x0a;    public void NotifyUser(string message)&#x0a;    {&#x0a;        _notification.Send(message);&#x0a;    }&#x0a;}&#x0a;&#x0a;// Utilisation: var service = new UserService(new EmailNotification());&#x0a;// ou: var service = new UserService(new SmsNotification());" />
                    </VerticalStackLayout>
                </Border>

                <!-- Pros and Cons -->
                <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                    <!-- Pros -->
                    <Border Style="{StaticResource ProCard}">
                        <VerticalStackLayout Spacing="12">
                            <HorizontalStackLayout Spacing="8">
                                <Label Text="✅" FontSize="20" />
                                <Label Text="Avantages" FontAttributes="Bold"
                                       Style="{StaticResource BodyLarge}" />
                            </HorizontalStackLayout>
                            <VerticalStackLayout Spacing="6">
                                <Label Text="• Couplage réduit"
                                       Style="{StaticResource BodySmall}" />
                                <Label Text="• Flexibilité maximale"
                                       Style="{StaticResource BodySmall}" />
                                <Label Text="• Tests facilités (mocking)"
                                       Style="{StaticResource BodySmall}" />
                                <Label Text="• Changements d'implémentation simples"
                                       Style="{StaticResource BodySmall}" />
                            </VerticalStackLayout>
                        </VerticalStackLayout>
                    </Border>
                    
                    <!-- Cons -->
                    <Border Style="{StaticResource ConCard}">
                        <VerticalStackLayout Spacing="12">
                            <HorizontalStackLayout Spacing="8">
                                <Label Text="⚠️" FontSize="20" />
                                <Label Text="Points d'attention" FontAttributes="Bold"
                                       Style="{StaticResource BodyLarge}" />
                            </HorizontalStackLayout>
                            <VerticalStackLayout Spacing="6">
                                <Label Text="• Nécessite un conteneur DI"
                                       Style="{StaticResource BodySmall}" />
                                <Label Text="• Plus d'abstractions à créer"
                                       Style="{StaticResource BodySmall}" />
                                <Label Text="• Courbe d'apprentissage initiale"
                                       Style="{StaticResource BodySmall}" />
                            </VerticalStackLayout>
                        </VerticalStackLayout>
                    </Border>
                </Grid>

            </VerticalStackLayout>
        </ScrollView>
    </Grid>
</ContentPage>
